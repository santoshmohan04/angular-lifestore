<div class="container p-5 mt-5">
  <div class="d-flex">
    <div ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-pills flex-column" orientation="vertical">
      <ng-container ngbNavItem="pswd">
        <button ngbNavLink>Change Password</button>
        <ng-template ngbNavContent>
          <div class="card">
          <div class="alert alert-danger" *ngIf="error">
            <p>{{ error }}</p>
          </div>
          <div *ngIf="isLoading" class="loader">
            <app-loading-spinner></app-loading-spinner>
          </div>
          <form
            #chngpswdForm="ngForm"
            (ngSubmit)="onChange(chngpswdForm)"
            *ngIf="!isLoading"
          >
            <div class="mb-3">
              <label for="email">Enter new Password</label>
              <input
                type="password"
                class="form-control"
                name="newpswd"
                id="newpswd"
                ngModel
                required
                minlength="6"
              />
            </div>
            <div class="mb-3">
              <label for="email">Conform the Password</label>
              <input
                type="password"
                class="form-control"
                name="repswd"
                id="repswd"
                ngModel
                required
                minlength="6"
              />
            </div>
            <button
              type="submit"
              name="chngpsw"
              class="btn btn-primary"
              [disabled]="!chngpswdForm.valid"
            >
              Change
            </button>
          </form>
        </div>
        </ng-template>
      </ng-container>
      <ng-container ngbNavItem="orders">
        <button ngbNavLink>Orders</button>
        <ng-template ngbNavContent>
            <div ngbAccordion [closeOthers]="true" *ngIf="userOrds.length > 0" style="width: 600px;">
              @for (order of userOrds; track order.id; let i = $index) {
                <div ngbAccordionItem>
                  <h2 ngbAccordionHeader>
                    <button ngbAccordionButton>Order Date: {{ order.date | date:'medium' }} - Total: Rs.{{ order.total | number }}</button>
                  </h2>
                  <div ngbAccordionCollapse>
                    <div ngbAccordionBody>
                      <ng-template>
                        <table
                        class="table table-striped table-hover"
                        aria-describedby="userOrders"
                      >
                        <thead class="table-dark">
                          <tr>
                            <th>Product ID</th>
                            <th>Image</th>
                            <th>Item Name</th>
                            <th>Quantity</th>
                            <th>Price</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let item of order.items">
                            <td>{{ item.productId }}</td>
                            <td>
                              <img
                                src="assets/{{ item.image }}"
                                alt="{{ item.name }}"
                                class="card-img-top"
                                height="60px"
                              />
                            </td>
                            <td>{{ item.name }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>Rs.{{ item.price | number }}</td>
                          </tr>
                        </tbody>
                      </table>
                      </ng-template>
                    </div>
                  </div>
                </div>
              }
            </div>
            <div *ngIf="userOrds.length === 0" class="alert alert-info">
              <p>No orders found.</p>
            </div>
        </ng-template>
      </ng-container>
      <ng-container ngbNavItem="profile">
        <button ngbNavLink>Profile</button>
        <ng-template ngbNavContent>
          <div class="card">
          <h3 style="text-align: center; color: blue">User Profile</h3>
          <div class="row">
            <div class="col-sm-4">
              <img
                src='assets/img/dummy-user.png'
                [alt]="userdetails.displayName"
                height="120px"
              />
            </div>
            <div class="col-sm-8">
              <p>
                Hello: <strong>{{ userdetails.displayName ? userdetails.displayName : "User" }}</strong>
              </p>
              <p>
                User ID: <strong>{{ userdetails.localId }}</strong>
              </p>
              <p>
                Email: <strong>{{ userdetails.email }}</strong>
              </p>
            </div>
          </div>
        </div>
        </ng-template>
      </ng-container>
    </div>
  
    <div [ngbNavOutlet]="nav" class="ms-4"></div>
  </div>
</div>
